
<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<link rel="stylesheet" type="text/css" href="style.css">
<link href="https://fonts.googleapis.com/css?family=Bree+Serif|Open+Sans:300,300i,700&display=swap" rel="stylesheet"> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<div id="timeline">
<span id="part-intro"><div class="timeline-tooltip">When might we need boxplots?</div><a href="#intro-link">Introduction</a></span> - <span id="part-const"><div class="timeline-tooltip">Defining maximum, minimum, median, interquartile range</div><a href="#const-link">Construction</a></span> - <span id="part-sand"><div class="timeline-tooltip">An interactive data table and visualisation</div><a href="#sandbox-link">Sandbox</a></span> - <span id="part-answer"><div class="timeline-tooltip">Scale, variance, comparing visualisations to answer questions</div><a href="#answering-questions-link">Answering questions</a></span>
</div>

<div class="header">
<h2 class="above">An interactive introduction to</h2>
<h1>Box plots</h1>
<h2 class="beyond">and what they're good for</h2>
</div>

<div class="intro-text">
  <h1>Boxplots are a fairly popular visualisation type, but one needs to know how to read them in order to extract useful conclusions. This introductory explainer contains an <a href="#intro-link" class="type-orange part-current">example scenario</a>, a <a href="#const-link" class="type-green">vis construction</a>, a <a href="#sandbox-link" class ="type-purple"> sandbox</a>, and an <a href="#answering-questions-link" class="type-red">answering questions</a> section to get you started.</h1>
</div>

<div id='container' class='container-0'>
  <div id='graph'></div>
  <div id='sections'>
    <div class="one-liner">
      <div class="buffer"></div>
      <h3 id="intro-link">Introduction</h3>
      <span class="blue-note"> Let's start with an example scenario where boxplots might come in handy...</span>
    </div>

    <div>
    	[restaurant noises]
    </div>

    <div>
      Do you have any plans for the coming Easter holiday?
    </div>

    <div>
      Let's go skiing!
    </div>

    <div>
      That's a good idea! But we don't know which mountain will have snow, and it's too early to see the weather forecast.
    </div>


    <div>
      It seems we need to find a place with a high chance of snow.
    </div>

    <div class="last-div">
      What about using <span class="bolded">boxplots</span> to visualise and compare different mountain snowfall?
    </div>

  </div>

</div>

<div id='container' class='container-2'>
  <div id='graph'></div>

  <div id='sections'>

    <div>
      <h3 id="const-link">Construction</h3>
      As a first step, let's learn how to construct a boxplot from snowfall data from one mountain. To start, we can <span class="bolded">order the values in the data by ascending order</span>.
    </div>

    <div>
      By <span class="bolded">splitting the data into two equal groups</span>, we obtain the middle value, called the <span class="hl-word const-median-hl">median</span>. <span class="blue-note">(By the way, you can hover over blue elements to highlight them in the visualisation. Try it with "median" in the previous sentence!)</span>
    </div>


    <div>
      The median values obtained by <span class="bolded">splitting the lower and higher halves</span> are called the <span class="hl-word const-q1-hl">lower quartile</span> and <span class="hl-word const-q3-hl">higher quartile</span>.
    </div>

    <div>
      We link these three values with a <span class="bolded">box.
    </div>

    <div class="last-div">
      Finally, we plot the <span class="hl-word const-min-hl">minimum</span> and <span class="hl-word const-max-hl">maximum</span>, which make the "whiskers" of our graph. This completes our boxplot!
    </div>
  </div>


</div>

<div class="separator"></div>

<div class="intro-text">
<h1 id="sandbox-link">
  It's time for you to try playing around with how data affects a boxplot: let's go to the sandbox.
</h1>
</div>

<!-- sandbox -->
<div id='container' class='container-3'>
  <div id='graph'></div>

  <div id='sections'>

  	<div>
  		 <span class="blue-note">Let's try an interactive example...</span>
  	</div>

    <div style="min-height: 800px;">
      <h3>Sandbox</h3>
      <p class="blue-note">Edit the data in the table and watch the visualisation and summary values change. You can also hover over the values below the table to see where they are in the visualisation.</p>
       <table id= "test-table" style="border: 1px solid blue; border-radius: 5px; padding:10px; margin: 0 auto;">
        <tr>
          <th>Year</th>
          <th style="text-align: center;">Snowfall</th>
        </tr>
        <tr>
          <td>2020</td>
          <td>      
            <label for="data-1">
               <span id="data-1-value"></span>
            </label>
            <input type="number" min="0" max="360" value="12" id="data-1" class="dataval"></td>
        </tr>
        <tr>
          <td>2019</td>
          <td>
            <label for="data-2" >
               <span id="data-2-value"></span>
            </label>
            <input type="number" min="0" max="360" value="19" id="data-2" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2018</td>
          <td>
            <label for="data-3">
               <span id="data-3-value"></span>
            </label>
            <input type="number" min="0" max="360" value="12" id="data-3" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2017</td>
          <td>
            <label for="data-4">
               <span id="data-4-value"></span>
            </label>
            <input type="number" min="0" max="360" value="11" id="data-4" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2016</td>
          <td>
            <label for="data-5">
               <span id="data-5-value"></span>
            </label>
            <input type="number" min="0" max="360" value="22" id="data-5" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2015</td>
          <td>
            <label for="data-6">
               <span id="data-6-value"></span>
            </label>
            <input type="number" min="0" max="360" value="13" id="data-6" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2014</td>
          <td>
            <label for="data-7">
               <span id="data-7-value"></span>
            </label>
            <input type="number" min="0" max="360" value="4" id="data-7" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2013</td>
          <td>
            <label for="data-8">
               <span id="data-8-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="5" id="data-8" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2012</td>
          <td>
            <label for="data-9">
               <span id="data-9-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="15" id="data-9" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2011</td>
          <td>
            <label for="data-10">
               <span id="data-10-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="16" id="data-10" class="dataval"></td>
          </td>
        </tr>
      </table> 

      <p style="text-align: center;">
        <span class="hl-word min-hl">Min: <span id="min-stat"></span></span>
        <span class="hl-word max-hl">Max: <span id="max-stat"></span></span>
        <span class="hl-word median-hl">Median: <span id="median-stat"></span></span>
      </p>
      <p style="text-align: center;">
        <span class="hl-word q1-hl">Q1: <span id="q1-stat"></span></span>
        <span class="hl-word iqr-hl">Interquartile Range: <span id="inter-stat"></span></span>
        <span class="hl-word q3-hl">Q3: <span id="q3-stat"></span></span>
      </p>

    </div>
  </div>
</div>

<div id="answering-questions-link">
</div>

<div id='container' class='container-4'>
  <div id='graph'></div>

  <div id='sections'>

    <div>
	  <h3>Answering questions</h3>
      Great! We know understand how boxplots work. But how do we use boxplots to make a decision?
    </div>

    <div>
      First, we need to plot data from another mountain. Then we can compare.
   </div>
    <div>
      Here's our mountain 1 data...
   </div>
    <div>
      And here's some data from mountain 2. 
   </div>
   <div>
      Note that the <span class="bolded">scale</span> should be the same for them to be comparable!
   </div>
   <div>
      The extreme values give us information on the minimum, maximum and <span class="bolded">variance</span>: the spread of data.
   </div>
   <div>
      Mountain 1 has <span class="bolded">greater variance</span>: this means the annual snowfall data is more spread out.
   </div>
   <div>
    Meanwhile, Mountain 2 has <span class="bolded">smaller variance</span>, which means that snowfall doesn't vary as much year to year.
   </div>
    <div>
    We can look for the mountain with a <span class="bolded">smaller variance</span>, and a <span class ="bolded">greatest chance</span> to receive snowfall more than a certain value, say, <span class="bolded">200cm</span>.
   </div>
    <div>
    That would be mountain 2!
   </div>
   <div style="min-height: 500px;">
    Amazing, we've learnt a lot. Now I can't wait for the Easter Holidays!
   </div>
  </div>


</div>



<script src="d3v4+jetpack.js"></script>
<script src="graph-scroll.js"></script>
<script type="text/javascript" src="scrollytell.js"></script>
<script>

// BOXPLOT SETUP ----------------------------------------------------

// set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 40},
  width = 400 - margin.left - margin.right,
  height = 400 - margin.top - margin.bottom;
// END --------------------------------------------------------------


// graph-scroll setup -----------------------------------------------

var oldWidth = 0
function render(){
  if (oldWidth == innerWidth) return
  oldWidth = innerWidth

  var width = height = d3.select('#graph').node().offsetWidth
  var r = 40


  if (innerWidth <= 925){
    width = innerWidth
    height = innerHeight*.7
  }

// END -------------------------------------------------------------

// Testing static images -------------------------------------------

  var svg0 = d3.select('.container-0 #graph').html('')
    .append('svg')
    .attrs({width: width, height: height});

    svg0.append("rect")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("fill", "white");
 
  var comic_squares = ["comic_1", "comic_1", "comic_2", "comic_3", "comic_4", "comic_5", "comic_2"]
  var gs0 = d3.graphScroll()
  	  .offset(300) // sets the offset overall
      .container(d3.select('.container-0'))
      .graph(d3.selectAll('.container-0 #graph'))
      .eventId('uniqueId0')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-0 #sections > div'))
      .on('active', function(i){
        // transitions
        svg0.append("svg:image")
        .attr('x', -9)
        .attr('y', -12)
        .attr('width', 500)
        .attr('height', 500)
        .attr("xlink:href", "images/" + comic_squares[i] + ".png")

		scrollytell.set_timeline_section("part-intro");
      })


// END -------------------------------------------------------------


// BOXPLOT CONSTRUCTION FROM MOCKUP ---------------------------------------

// set the dimensions and margins of the graph
var margin_2 = {top: 10, right: 30, bottom: 30, left: 40},
  width_2 = 500 - margin_2.left - margin_2.right,
  height_2 = 300 - margin_2.top - margin_2.bottom;

// Show the X scale
var x_2 = d3.scaleLinear()
  .domain([0,400])
  .range([0, width_2])

// append the svg object to the body of the page
var svg2 = d3.select(".container-2 #graph").html('')
.append("svg")
  .attr("width", width_2 + margin_2.left + margin_2.right)
  .attr("height", height_2 + margin_2.top + margin_2.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin_2.left + "," + margin_2.top + ")");


// END -------------------------------------------------------------------


// BASIC VERTICAL BOXPLOT -------------------------------------------------

//   var svg2 = d3.select('.container-2 #graph').html('')
//     .append('svg')
//       // .attrs({width: width, height: height})
// .attr("width", width + margin.left + margin.right)
//   .attr("height", height + margin.top + margin.bottom)
// .append("g")
//   .attr("transform",
//         "translate(" + margin.left + "," + margin.top + ")");

// // create dummy data
// var data = [12,19,11,13,12,22,13,4,15,16,18,19,20,12,11,9]

// // Compute summary statistics used for the box:
// var data_sorted = data.sort(d3.ascending)
// var q1 = d3.quantile(data_sorted, .25)
// var median = d3.quantile(data_sorted, .5)
// var q3 = d3.quantile(data_sorted, .75)
// var interQuantileRange = q3 - q1
// var min = q1 - 1.5 * interQuantileRange
// var max = q1 + 1.5 * interQuantileRange

// // Show the Y scale
// var y = d3.scaleLinear()
//   .domain([0,24])
//   .range([height, 0]);
// svg2.call(d3.axisLeft(y))

// // a few features for the box
// var center = 200
// var width = 100

// // Show the main vertical line
// svg2
// .append("line")
//   .attr("x1", center)
//   .attr("x2", center)
//   .attr("y1", y(min) )
//   .attr("y2", y(max) )
//   .attr("stroke", "black")

// // Show the box
// svg2
// .append("rect")
//   .attr("x", center - width/2)
//   .attr("y", y(q3) )
//   .attr("height", (y(q1)-y(q3)) )
//   .attr("width", width )
//   .attr("stroke", "black")
//   .style("fill", "#69b3a2")

// // show median, min and max horizontal lines
// svg2
// .selectAll("toto")
// .data([min, median, max])
// .enter()
// .append("line")
//   .attr("x1", center-width/2)
//   .attr("x2", center+width/2)
//   .attr("y1", function(d){ return(y(d))} )
//   .attr("y2", function(d){ return(y(d))} )
//   .attr("stroke", "black")

// END ----------------------------------------------------------



// sandbox boxplot ----------------------------------------------


// create dummy data
var data =  [ 4, 5, 11, 12, 12, 13, 15, 16, 19, 22 ]

// Compute summary statistics used for the box
function calculate_stats(data) {

	var data_sorted = data.sort(d3.ascending)
	var q1 = d3.quantile(data_sorted, .25)
	var median = d3.quantile(data_sorted, .5)
	var q3 = d3.quantile(data_sorted, .75)
	var interQuantileRange = q3 - q1
    var min = Math.min(...data)
    var max = Math.max(...data)

	return stats = {
	  q1: q1,
	  median: median,
	  q3: q3,
	  interQuantileRange: interQuantileRange,
	  min: min,
	  max: max
	};
}

var svg3_stats = calculate_stats(data);

svg3_settings = {
	margin: {top: 10, right: 30, bottom: 30, left: 40},
	width: 500 - margin.left - margin.right,
	height: 300 - margin.top - margin.bottom,
	center: 200,
	line_height: 50
}

var values = scrollytell.init_svg(".container-3 #graph", svg3_settings);
var svg3 = values[0];
var x = values[1];

scrollytell.show_scale(svg3, svg3_settings, x);
scrollytell.add_boxplot(svg3, "svg3", svg3_settings, svg3_stats, x);

var height = 50 //TODO refactor, this is used for the rectangle actually

// create tooltips
// TODO refactor this into scrollytell.js
// TODO handle overlapping elements, by writing a function that gives priority for tooltip https://www.sitepoint.com/community/t/determine-if-mouse-is-over-an-element/4239/2
// TODO handle z-index sorting for highlighting


var tooltip = d3.select("body")
	.append("div")
	.style("position", "absolute")
	.style("z-index", "10")
	.style("visibility", "hidden")
	.style("color","blue")
	.style("font-size", "18px")
	.style("background-color", "white")
    .style("border", "solid")
    .style("border-color","blue")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")
    .text("a simple tooltip");

var mouseover = function(d) {
	tooltip
	  .style("visibility", "visible");
    d3.select(this)
	  .attr("stroke", "blue")
	  .style("stroke-width", 5)

	if (this.id == "svg3-rect") {
		tooltip.text("Interquartile Range: " + svg3_stats.interQuantileRange + " (" + svg3_stats.q1 + " to " + svg3_stats.q3 + ")")
	}
	else if (this.id == "svg3-min") {
		tooltip.text("Minimum: " + svg3_stats.min)
	}
	else if (this.id == "svg3-max") {
		tooltip.text("Maximum: " + svg3_stats.max)
	}
  }

var mousemove = function(d) {
	tooltip
	  .style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px")
	}

var mouseleave = function(d) {
	tooltip
	  .style("visibility", "hidden");
    d3.select(this)
	  .attr("stroke", "grey")
	  .style("stroke-width", 3)
  }

//TODO this doesn't add actual handling of tooltip, which is above
function add_tooltip(graph, element_id) {

	graph.select(element_id)
		.on("mouseover", mouseover)
	    .on("mousemove", mousemove)
	    .on("mouseleave", mouseleave)
}	

add_tooltip(svg3, "#svg3-rect");
add_tooltip(svg3, "#svg3-min");
add_tooltip(svg3, "#svg3-max");

// TODO refactor visualisations to create all elements at the same time, then toggle visibility instead of creating in steps
// TODO make variables for colours, stroke-weight

// TABLE UPDATE

var elements = document.getElementsByClassName("dataval");

var update_datavis = function() {

  data = [];

  $("table#test-table tr td input.dataval").each(function() {  
    data.push(Number($(this).val()));
});

  var svg3_stats = calculate_stats(data);

  //reupdate range & ticks
  x.domain([svg3_stats.min, svg3_stats.max]);
  svg3.select("g")
    .transition()
    .duration(1000)
    .call(d3.axisBottom(x))

  // update displayed statistics
  d3.select("#q1-stat").text(svg3_stats.q1);
  d3.select("#q3-stat").text(svg3_stats.q3);
  d3.select("#median-stat").text(svg3_stats.median);
  d3.select("#inter-stat").text(svg3_stats.interQuantileRange);
  d3.select("#min-stat").text(svg3_stats.min);
  d3.select("#max-stat").text(svg3_stats.max);

  // update visualisation
scrollytell.update_svg(svg3, svg3_stats, x, center, line_height);

};

for (var i = 0; i < elements.length; i++) {
    elements[i].addEventListener('input', update_datavis , false);
}

// initialise the datavis to data table
update_datavis();


// hover effects construction -------------------------------

// BUG sometimes shows it as stroke 5 black-- might be due the deletion/recreation and duplicates?

scrollytell.hover_text("const-median-hl", svg2, "line.median-line");
scrollytell.hover_text("const-q1-hl", svg2, "line.q1-line");
scrollytell.hover_text("const-q3-hl", svg2, "line.q3-line");
scrollytell.hover_text("const-min-hl", svg2, "line.min-line");
scrollytell.hover_text("const-max-hl", svg2, "line.max-line");

// END ------------------------------------------------------


// hover effects sandbox ------------------------------------

scrollytell.hover_text("min-hl", svg3, "line.min-line");
scrollytell.hover_text("max-hl", svg3, "line.max-line");
scrollytell.hover_text("median-hl", svg3, "line.median-line");
scrollytell.hover_text("iqr-hl", svg3, "rect");
scrollytell.hover_text("q1-hl", svg3, "line.q1-line");
scrollytell.hover_text("q3-hl", svg3, "line.q3-line");

// END ----------------------------------------------------------



// construction scroll setup --------------------------------------

svg2.selectAll("line.median-line").remove()


  var path = svg2.append('path')

  var gs2 = d3.graphScroll()
      .container(d3.select('.container-2'))
      .graph(d3.selectAll('.container-2 #graph'))
      .eventId('uniqueId2')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-2 #sections > div'))
      .on('active', function(i){ // JUMP

        var const_squares_2 = ["const_1", "const_2", "const_3", "const_3", "const_4"]

        svg2.append("svg:image")
          .attr('x', -40)
          .attr('y', 0)
          .attr('width', 500)
          .attr('height', 96)
          .attr("xlink:href", "images/" + const_squares_2[i] + ".jpg")

        // show the x scale
        svg2.append("g")
          .attr("transform", "translate(0," + height_2 + ")")
          .call(d3.axisBottom(x_2))

        if (i == 0) {
          svg2.selectAll("line.median-line").remove()
        }
    
        else if (i == 1) {
		  scrollytell.set_timeline_section("part-const");

          svg2.selectAll("line.q1-line").remove()
          svg2.selectAll("line.q3-line").remove()
          svg2.selectAll("rect").remove()

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "median-line")
            .attr("x1", x_2(195))
            .attr("x2", x_2(195))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")


        }

        else if (i == 2) {

          svg2.selectAll("rect").remove()

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "q1-line")
            .attr("x1", x_2(125))
            .attr("x2", x_2(125))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "q3-line")
            .attr("x1", x_2(260))
            .attr("x2", x_2(260))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

        }

        else if (i == 3) {

          svg2.selectAll("line.min-line").remove()
          svg2.selectAll("line.max-line").remove()
          svg2.selectAll("line.vert-line").remove()

          svg2.append("rect")
            .transition()
            .duration(1000)
            .attr("x", x_2(125) )
            .attr("y",  center - height/2)
            .attr("height", height)
            .attr("width", (x_2(260)-x_2(125)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

          // re-drawing as rectangle draws on top
          // svg2.selectAll("line").remove()

          svg2.append("line")
            .attr("class", "median-line")
            .attr("x1", x_2(195))
            .attr("x2", x_2(195))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q1-line")
            .attr("x1", x_2(125))
            .attr("x2", x_2(125))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q3-line")
            .attr("x1", x_2(260))
            .attr("x2", x_2(260))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")
        }

        else if (i == 4) {

          //couldn't be bothered to delete all lines except vertical
          // will do this if duplicates end up being an issue
          svg2.select("rect").remove()

          // Show the main vertical line
          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "vert-line")
            .attr("x1", x_2(45))
            .attr("x2", x_2(380))
            .attr("y1", center )
            .attr("y2", center )
            .attr("stroke", "black")


          svg2.append("rect")
            .attr("x", x_2(125) )
            .attr("y",  center - height/2)
            .attr("height", height)
            .attr("width", (x_2(260)-x_2(125)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

          svg2.append("line")
            .attr("class", "median-line")
            .attr("x1", x_2(195))
            .attr("x2", x_2(195))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "min-line")
            .attr("x1", x_2(45))
            .attr("x2", x_2(45))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "max-line")
            .attr("x1", x_2(380))
            .attr("x2", x_2(380))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q1-line")
            .attr("x1", x_2(125))
            .attr("x2", x_2(125))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q3-line")
            .attr("x1", x_2(260))
            .attr("x2", x_2(260))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

        }


      })
// END ----------------------------------------------------------

// answering questions section  -------------------------------------------

// set the dimensions and margins of the graph
var margin_4 = {top: 10, right: 30, bottom: 30, left: 40},
  width_2 = 500 - margin_4.left - margin_4.right,
  height_2 = 300 - margin_4.top - margin_4.bottom;

// append the svg object to the body of the page
var svg4 = d3.select(".container-4 #graph").html('')
.append("svg")
  .attr("width", width_2 + margin_4.left + margin_4.right)
  .attr("height", height_2 + margin_4.top + margin_4.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin_4.left + "," + margin_4.top + ")");

  // a few features for the box
var center_draw = 200
var height_draw = 50


var mountain_1 = [ 52, 85, 120, 125, 154, 140, 186, 206, 395, 420]; // NEEDS TO BE ORDERED
var mountain_2 = [ 135, 145, 154, 162, 185, 252, 275, 278, 344, 382 ]; // NEEDS TO BE ORDERED

var mountain_1_stats = calculate_stats(mountain_1);
var mountain_2_stats = calculate_stats(mountain_2);

// Show the X scale
var x_4 = d3.scaleLinear()
  .domain([0,450])
  .range([0, width_2])

// // a few features for the box
// var center_2 = 200
 
  var gs4 = d3.graphScroll()
      .offset(300) // sets the offset overall
      .container(d3.select('.container-4'))
      .graph(d3.selectAll('.container-4 #graph'))
      .eventId('uniqueId4')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-4 #sections > div'))
      .on('active', function(i){

        if (i == 0) {

          svg4.append("rect")
            .attr('x', -40)
            .attr('y', -50)
            .attr("width", "100%")
            .attr("height", "140%")
            .attr("fill", "white")

          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_2.png")
        }
        else if (i == 1) {

		  scrollytell.set_timeline_section("part-answer");

          svg4.append("rect")
            .attr('x', -40)
            .attr('y', -50)
            .attr("width", "100%")
            .attr("height", "140%")
            .attr("fill", "white")

          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_5.png")
        }

        else if (i == 2) {

          svg4.append("rect")
            .attr('x', -40)
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "#ececed");

          // Show the X scale

          svg4.append("g")
            .attr("class", "scale")
            .attr("transform", "translate(0," + height_2 + ")")
            .call(d3.axisBottom(x_4))


          // Show the main vertical line
          svg4
          .append("line")
            .transition()
            .duration(1000)
            .attr("class", "vert-line")
            .attr("class", "vert-line-1")
            .attr("x1", x_4(mountain_1_stats.min))
            .attr("x2", x_4(mountain_1_stats.max))
            .attr("y1", center_draw - 100)
            .attr("y2", center_draw - 100)
            .attr("stroke", "black")

          // Show the box
          svg4
          .append("rect")
            .transition()
            .duration(1000)
            .attr("x", x_4(mountain_1_stats.q1) )
            .attr("y",  center - height_draw/2 - 100)
            .attr("height", height_draw)
            .attr("width", (x_4(mountain_1_stats.q3)-x_4(mountain_1_stats.q1)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

            svg4.append("line")
              .transition()
              .duration(1000)
              .attr("class", "min-line")
              .attr("x1", x_4(mountain_1_stats.min))
              .attr("x2", x_4(mountain_1_stats.min))
              .attr("y1", center-height/2 - 100)
              .attr("y2", center+height/2 - 100)
              .attr("stroke", "black")

            svg4.append("line")
              .transition()
              .duration(1000)
              .attr("class", "median-line")
              .attr("x1", x_4(mountain_1_stats.median))
              .attr("x2", x_4(mountain_1_stats.median))
              .attr("y1", center-height/2 - 100)
              .attr("y2", center+height/2 - 100)
              .attr("stroke", "black")

            svg4.append("line")
              .transition()
              .duration(1000)
              .attr("class", "max-line")
              .attr("x1", x_4(mountain_1_stats.max))
              .attr("x2", x_4(mountain_1_stats.max))
              .attr("y1", center-height/2 - 100)
              .attr("y2", center+height/2 - 100)
              .attr("stroke", "black")

        }

        else if (i == 3) {

          // Show the main vertical line
          svg4
          .append("line")
            .transition()
            .duration(1000)
            .attr("class", "vert-line")
            .attr("class", "vert-line-2")
            .attr("x1", x_4(mountain_2_stats.min))
            .attr("x2", x_4(mountain_2_stats.max))
            .attr("y1", center_draw )
            .attr("y2", center_draw )
            .attr("stroke", "black")

          // Show the box
          svg4
          .append("rect")
            .transition()
            .duration(1000)
            .attr("x", x_4(mountain_2_stats.q1) )
            .attr("y",  center - height_draw/2)
            .attr("height", height_draw)
            .attr("width", (x_4(mountain_2_stats.q3)-x_4(mountain_2_stats.q1)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

            svg4.append("line")
              .transition()
              .duration(1000)
              .attr("class", "min-line")
              .attr("x1", x_4(mountain_2_stats.min))
              .attr("x2", x_4(mountain_2_stats.min))
              .attr("y1", center-height/2)
              .attr("y2", center+height/2)
              .attr("stroke", "black")

            svg4.append("line")
              .transition()
              .duration(1000)
              .attr("class", "median-line")
              .attr("x1", x_4(mountain_2_stats.median))
              .attr("x2", x_4(mountain_2_stats.median))
              .attr("y1", center-height/2)
              .attr("y2", center+height/2)
              .attr("stroke", "black")

            svg4.append("line")
              .transition()
              .duration(1000)
              .attr("class", "max-line")
              .attr("x1", x_4(mountain_2_stats.max))
              .attr("x2", x_4(mountain_2_stats.max))
              .attr("y1", center-height/2)
              .attr("y2", center+height/2)
              .attr("stroke", "black")
        }

        else if (i == 4) {
            svg4.select("g.scale")
              .style("fill", "blue")
        }

        else if (i == 5) {
            svg4.select("g.scale")
              .style("fill", "none")

            svg4.select("line.vert-line-1")
              .style("stroke", "blue")
              .style("stroke-width", 5)


            svg4.select("line.vert-line-2")
              .style("stroke", "blue")
              .style("stroke-width", 5)

              
        }

        else if (i == 6) {
            svg4.select("line.vert-line-2")
              .style("stroke", "black")
              .style("stroke-width", 1)
        }

        else if (i == 7) {
            svg4.select("line.vert-line-1")
              .style("stroke", "black")
              .style("stroke-width", 1)

            svg4.select("line.vert-line-2")
              .style("stroke", "blue")
              .style("stroke-width", 5)
        }

        else if (i == 8) {
            svg4.select("line.vert-line-2")
              .style("stroke", "black")
              .style("stroke-width", 1)

          svg4
          .append("line")
            .transition()
            .duration(1000)
            .attr("class", "snowfall")
            .attr("x1", x_4(200))
            .attr("x2", x_4(200))
            .attr("y1", center_draw - 180)
            .attr("y2", center_draw + 50)
            .style("stroke", "blue")
            .style("stroke-width", 10)
        }

        else if (i == 9) {

          svg4
          .append("rect")
            .transition()
            .duration(1000)
            .attr("x", x_4(200) )
            .attr("y",  center - height_draw/2)
            .attr("height", 50)
            .attr("width", 175)
            .style("opacity", 0.2)
            .attr("stroke", "blue")
            .style("fill", "blue")

        }
        else if (i == 10) {
          svg4.append("rect")
            .attr('x', -40)
            .attr('y', -50)
            .attr("width", "100%")
            .attr("height", "140%")
            .attr("fill", "white")

          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_3.png")
        }
        
      })


// END -------------------------------------------------------------

// sandbox scroll setup --------------------------------------



  var path = svg3.append('path')

  var gs3 = d3.graphScroll()
      .container(d3.select('.container-3'))
      .graph(d3.selectAll('.container-3 #graph'))
      .eventId('uniqueId3')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-3 #sections > div'))
      .on('active', function(i){
        // code to affect while scrolling

        if (i == 1) {
			scrollytell.set_timeline_section("part-sand");
        }

      })
// END ----------------------------------------------------------

  d3.select('#source')
      .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
}
render()
d3.select(window).on('resize', render)





</script>
