
<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<link rel="stylesheet" type="text/css" href="style.css">
<link href="https://fonts.googleapis.com/css?family=Bree+Serif|Open+Sans:300,300i,700&display=swap" rel="stylesheet"> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<div id="timeline">
<span id="part-intro"><div class="timeline-tooltip">When might we need boxplots?</div><a href="#intro-link">Introduction</a></span> - <span id="part-const"><div class="timeline-tooltip">Defining maximum, minimum, median, interquartile range</div><a href="#const-link">Construction</a></span> - <span id="part-sand"><div class="timeline-tooltip">An interactive data table and visualisation</div><a href="#sandbox-link">Sandbox</a></span> - <span id="part-answer"><div class="timeline-tooltip">Scale, variance, comparing visualisations to answer questions</div><a href="#answering-questions-link">Answering questions</a></span>
</div>

<div class="header">
<h2 class="above">An interactive introduction to</h2>
<h1>Box plots</h1>
<h2 class="beyond">and what they're good for</h2>
</div>

<div class="intro-text">
  <h1>Boxplots are a fairly popular visualisation type, but one needs to know how to read them in order to extract useful conclusions. This introductory explainer contains an <a href="#intro-link" class="type-orange part-current">example scenario</a>, a <a href="#const-link" class="type-green">vis construction</a>, a <a href="#sandbox-link" class ="type-purple"> sandbox</a>, and an <a href="#answering-questions-link" class="type-red">answering questions</a> section to get you started.</h1>
</div>

<div id='container' class='container-0'>
  <div id='graph'></div>
  <div id='sections'>
    <div class="one-liner">
      <div class="buffer"></div>
      <h3 id="intro-link">Introduction</h3>
      <span class="blue-note"> Let's start with an example scenario where boxplots might come in handy...</span>
    </div>

    <div>
    	[restaurant noises]
    </div>

    <div>
      Do you have any plans for the coming Easter holiday?
    </div>

    <div>
      Let's go skiing!
    </div>

    <div>
      That's a good idea! But we don't know which mountain will have snow, and it's too early to see the weather forecast.
    </div>


    <div>
      It seems we need to find a place with a high chance of snow.
    </div>

    <div class="last-div">
      What about using <span class="bolded">boxplots</span> to visualise and compare different mountain snowfall?
    </div>

  </div>

</div>

<div id='container' class='container-2'>
  <div id='graph'></div>

  <div id='sections'>

    <div>
      <h3 id="const-link">Construction</h3>
      As a first step, let's learn how to construct a boxplot from snowfall data from one mountain. To start, we can <span class="bolded">order the values in the data by ascending order</span>.
    </div>

    <div>
      By <span class="bolded">splitting the data into two equal groups</span>, we obtain the middle value, called the <span class="hl-word const-median-hl">median</span>. <span class="blue-note">(By the way, you can hover over blue elements to highlight them in the visualisation. Try it with "median" in the previous sentence!)</span>
    </div>


    <div>
      The median values obtained by <span class="bolded">splitting the lower and higher halves</span> are called the <span class="hl-word const-q1-hl">first quartile</span> and <span class="hl-word const-q3-hl">third quartile</span>.
    </div>

    <div>
      We link these three values with a <span class="bolded">box.
    </div>

    <div class="last-div">
      Finally, we plot the <span class="hl-word const-min-hl">minimum</span> and <span class="hl-word const-max-hl">maximum</span>, which make the "whiskers" of our graph. This completes our boxplot!
    </div>
  </div>


</div>

<div class="separator"></div>

<div class="intro-text">
<h1 id="sandbox-link">
  It's time for you to try playing around with how data affects a boxplot: let's go to the sandbox.
</h1>
</div>

<!-- sandbox -->
<div id='container' class='container-3'>
  <div id='graph'></div>

  <div id='sections'>

  	<div>
  		 <span class="blue-note">Let's try an interactive example...</span>
  	</div>

    <div style="min-height: 800px;">
      <h3>Sandbox</h3>
      <p class="blue-note">Edit the data in the table and watch the visualisation and summary values change. You can also hover over the values below the table to see where they are in the visualisation.</p>
       <table id= "test-table" style="border: 1px solid blue; border-radius: 5px; padding:10px; margin: 0 auto;">
        <tr>
          <th>Year</th>
          <th style="text-align: center;">Snowfall</th>
        </tr>
        <tr>
          <td>2020</td>
          <td>      
            <label for="data-1">
               <span id="data-1-value"></span>
            </label>
            <input type="number" min="0" max="360" value="12" id="data-1" class="dataval"></td>
        </tr>
        <tr>
          <td>2019</td>
          <td>
            <label for="data-2" >
               <span id="data-2-value"></span>
            </label>
            <input type="number" min="0" max="360" value="19" id="data-2" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2018</td>
          <td>
            <label for="data-3">
               <span id="data-3-value"></span>
            </label>
            <input type="number" min="0" max="360" value="12" id="data-3" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2017</td>
          <td>
            <label for="data-4">
               <span id="data-4-value"></span>
            </label>
            <input type="number" min="0" max="360" value="11" id="data-4" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2016</td>
          <td>
            <label for="data-5">
               <span id="data-5-value"></span>
            </label>
            <input type="number" min="0" max="360" value="22" id="data-5" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2015</td>
          <td>
            <label for="data-6">
               <span id="data-6-value"></span>
            </label>
            <input type="number" min="0" max="360" value="13" id="data-6" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2014</td>
          <td>
            <label for="data-7">
               <span id="data-7-value"></span>
            </label>
            <input type="number" min="0" max="360" value="4" id="data-7" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2013</td>
          <td>
            <label for="data-8">
               <span id="data-8-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="5" id="data-8" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2012</td>
          <td>
            <label for="data-9">
               <span id="data-9-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="15" id="data-9" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2011</td>
          <td>
            <label for="data-10">
               <span id="data-10-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="16" id="data-10" class="dataval"></td>
          </td>
        </tr>
      </table> 

      <p style="text-align: center;">
        <span class="hl-word min-hl">Min: <span id="min-stat"></span></span>
        <span class="hl-word max-hl">Max: <span id="max-stat"></span></span>
        <span class="hl-word median-hl">Median: <span id="median-stat"></span></span>
      </p>
      <p style="text-align: center;">
        <span class="hl-word q1-hl">Q1: <span id="q1-stat"></span></span>
        <span class="hl-word iqr-hl">Interquartile Range: <span id="inter-stat"></span></span>
        <span class="hl-word q3-hl">Q3: <span id="q3-stat"></span></span>
      </p>

    </div>
  </div>
</div>

<div id="answering-questions-link">
</div>

<div id='container' class='container-4'>
  <div id='graph'></div>

  <div id='sections'>

    <div>
	  <h3>Answering questions</h3>
      Great! We know understand how boxplots work. But how do we use boxplots to make a decision?
    </div>

    <div>
      First, we need to plot data from another mountain. Then we can compare.
   </div>
    <div>
      Here's our mountain 1 data...
   </div>
    <div>
      And here's some data from mountain 2. 
   </div>
   <div>
      Note that the <span class="bolded">scale</span> should be the same for them to be comparable!
   </div>
   <div>
      The extreme values give us information on the minimum, maximum and <span class="bolded">variance</span>: the spread of data.
   </div>
   <div>
      Mountain 1 has <span class="bolded">greater variance</span>: this means the annual snowfall data is more spread out.
   </div>
   <div>
    Meanwhile, Mountain 2 has <span class="bolded">smaller variance</span>, which means that snowfall doesn't vary as much year to year.
   </div>
    <div>
    We can look for the mountain with a <span class="bolded">smaller variance</span>, and a <span class ="bolded">greatest chance</span> to receive snowfall more than a certain value, say, <span class="bolded">200cm</span>.
   </div>
    <div>
    That would be mountain 2!
   </div>
   <div style="min-height: 500px;">
    Amazing, we've learnt a lot. Now I can't wait for the Easter Holidays!
   </div>
  </div>


</div>



<script src="d3v4+jetpack.js"></script>
<script src="graph-scroll.js"></script>
<script type="text/javascript" src="learn.js"></script>
<script>

// BOXPLOT SETUP ----------------------------------------------------

// set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 40},
  width = 400 - margin.left - margin.right,
  height = 400 - margin.top - margin.bottom;
// END --------------------------------------------------------------


// graph-scroll setup -----------------------------------------------

var oldWidth = 0
function render(){
  if (oldWidth == innerWidth) return
  oldWidth = innerWidth

  var width = height = d3.select('#graph').node().offsetWidth
  var r = 40


  if (innerWidth <= 925){
    width = innerWidth
    height = innerHeight*.7
  }

// END -------------------------------------------------------------

// Introduction setup -------------------------------------------


svg0_settings = {
	margin: {top: 10, right: 30, bottom: 30, left: 40},
	width: 600 - margin.left - margin.right,
	height: 400 - margin.top - margin.bottom,
	images: ["comic_1", "comic_1", "comic_2", "comic_3", "comic_4", "comic_5", "comic_2"]
}

var gs0 = learn.init_story(0, svg0_settings, "part-intro");


// END -------------------------------------------------------------


// sandbox boxplot ----------------------------------------------


// create dummy data
var data =  [ 4, 5, 11, 12, 12, 13, 15, 16, 19, 22 ]

var svg3_stats = learn.calculate_stats(data);

svg3_settings = {
	margin: {top: 10, right: 30, bottom: 30, left: 40},
	width: 500 - margin.left - margin.right,
	height: 500 - margin.top - margin.bottom,
	center: 200,
	line_height: 50,
	x_domain: [24, 0],
	graph_title: "Distribution of snowfall",
	graph_axis: "Snowfall (in cms)",
  	orientation: "vertical",
  	labels: true
}

// TODO rename x to x_3
var values = learn.init_svg(".container-3 #graph", svg3_settings);
var svg3 = values[0];
var x_3 = values[1];

learn.show_scale(svg3, svg3_settings, x_3);
learn.add_boxplot(svg3, "svg3", svg3_settings, svg3_stats, x_3);

var height = 50 //TODO refactor, this is used for the rectangle actually

// create tooltips
// TODO refactor this into learn.js
// TODO handle overlapping elements, by writing a function that gives priority for tooltip https://www.sitepoint.com/community/t/determine-if-mouse-is-over-an-element/4239/2
// TODO handle z-index sorting for highlighting


var tooltip = d3.select("body")
	.append("div")
	.style("position", "absolute")
	.style("z-index", "10")
	.style("visibility", "hidden")
	.style("color","blue")
	.style("font-size", "18px")
	.style("background-color", "white")
    .style("border", "solid")
    .style("border-color","blue")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")
    .text("a simple tooltip");

var mouseover = function(d) {
	tooltip
	  .style("visibility", "visible");
    d3.select(this)
	  .attr("stroke", "blue")
	  .style("stroke-width", 5)

	if (this.id == "svg3-rect") {
		tooltip.text("Interquartile Range: " + svg3_stats.interQuantileRange + " (" + svg3_stats.q1 + " to " + svg3_stats.q3 + ")")
	}
	else if (this.id == "svg3-min") {
		tooltip.text("Minimum: " + svg3_stats.min)
	}
	else if (this.id == "svg3-max") {
		tooltip.text("Maximum: " + svg3_stats.max)
	}
  }

var mousemove = function(d) {
	tooltip
	  .style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px")
	}

var mouseleave = function(d) {
	tooltip
	  .style("visibility", "hidden");
    d3.select(this)
	  .attr("stroke", "grey")
	  .style("stroke-width", 3)
  }

//TODO this doesn't add actual handling of tooltip, which is above
function add_tooltip(graph, element_id) {

	graph.select(element_id)
		.on("mouseover", mouseover)
	    .on("mousemove", mousemove)
	    .on("mouseleave", mouseleave)
}	

add_tooltip(svg3, "#svg3-rect");
add_tooltip(svg3, "#svg3-min");
add_tooltip(svg3, "#svg3-max");

// TODO refactor visualisations to create all elements at the same time, then toggle visibility instead of creating in steps
// TODO make variables for colours, stroke-weight

// TODO refactor this table update section

// TABLE UPDATE

var elements = document.getElementsByClassName("dataval");

var update_datavis = function() {

  data = [];

  $("table#test-table tr td input.dataval").each(function() {  
    data.push(Number($(this).val()));
});

  var svg3_stats = learn.calculate_stats(data);

  //reupdate range & ticks
  x_3.domain([24, 0]);
  svg3.select("g")
    .transition()
    .duration(1000)
    .call(d3.axisLeft(x_3))

  // update displayed statistics
  d3.select("#q1-stat").text(svg3_stats.q1);
  d3.select("#q3-stat").text(svg3_stats.q3);
  d3.select("#median-stat").text(svg3_stats.median);
  d3.select("#inter-stat").text(svg3_stats.interQuantileRange);
  d3.select("#min-stat").text(svg3_stats.min);
  d3.select("#max-stat").text(svg3_stats.max);

  // update visualisation
learn.update_boxplot(svg3, "svg3", svg3_settings, svg3_stats, x_3);

};

for (var i = 0; i < elements.length; i++) {
    elements[i].addEventListener('input', update_datavis , false);
}

// initialise the datavis to data table
update_datavis();


// contruction section ---------------------------------------

svg2_settings = {
	margin: {top: 10, right: 30, bottom: 30, left: 40},
	width: 500 - margin.left - margin.right,
	height: 500 - margin.top - margin.bottom,
	center: 200,
	line_height: 50,
	x_domain: [400, 0], // inverted so high numbers are higher
	graph_title: "Distribution of snowfall",
	graph_axis: "Snowfall (in cms)",
  	orientation: "vertical",
  	labels: true
}

const_data = [45, 58, 88, 111, 125, 140, 155, 168, 170, 195, 211, 224, 235, 255, 260, 285, 320, 333, 380];

var values_2 = learn.init_svg(".container-2 #graph", svg2_settings);
var svg2 = values_2[0];
var x_2 = values_2[1];

// svg2.selectAll("line.median-line").remove()


  var path = svg2.append('path')

  var gs2 = d3.graphScroll()
      .container(d3.select('.container-2'))
      .graph(d3.selectAll('.container-2 #graph'))
      .eventId('uniqueId2')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-2 #sections > div'))
      .on('active', function(i){ // JUMP

        var const_squares_2 = ["const_1", "const_2", "const_3", "const_3", "const_4"]

        svg2.append("svg:image")
          .attr('x', -40)
          .attr('y', 50)
          .attr('width', 500)
          .attr('height', 96)
          .attr("xlink:href", "images/" + const_squares_2[i] + ".jpg")
          .attr("opacity", 0) // TODO testing

    	console.log(i);

		if (i == 0) {

			//TODO change classes to ids for highlights
			//TODO refactor so you can just specify for which graph you want to turn on the scale
			learn.show_scale(svg2, svg2_settings, x_2);
			learn.add_boxplot(svg2, "const", svg2_settings, learn.calculate_stats(const_data), x_2, "");
			svg2.selectAll(".const").style("opacity", 0);

		}

		else if (i == 1) {
			learn.set_timeline_section("part-const");

			learn.make_visible(svg2, "q1-line", false);
			learn.make_visible(svg2, "q3-line", false);
			learn.make_visible(svg2, "q1-text", false);
			learn.make_visible(svg2, "q3-text", false);

			learn.make_visible(svg2, "median-line", true);
			learn.make_visible(svg2, "med-text", true);
		}

		else if (i == 2) {
			learn.make_visible(svg2, "rect", false);
			learn.make_visible(svg2, "rect-text", false);

			learn.make_visible(svg2, "q1-line", true);
			learn.make_visible(svg2, "q3-line", true);
			learn.make_visible(svg2, "q1-text", true);
			learn.make_visible(svg2, "q3-text", true);
		}

		else if (i == 3) {
			learn.make_visible(svg2, "min-line", false);
			learn.make_visible(svg2, "max-line", false);
			learn.make_visible(svg2, "vert-line", false);
			learn.make_visible(svg2, "min-text", false);
			learn.make_visible(svg2, "max-text", false);

			learn.make_visible(svg2, "rect", true);
			learn.make_visible(svg2, "rect-text", true);
		}
		else if (i == 4) {
			learn.make_visible(svg2, "min-line", true);
			learn.make_visible(svg2, "max-line", true);
			learn.make_visible(svg2, "vert-line", true);
			learn.make_visible(svg2, "min-text", true);
			learn.make_visible(svg2, "max-text", true);
		}

		})


// const beeswarm data -------------------------

bee_const_data = learn.array_to_object(const_data);

learn.add_beeswarm(svg2, "const", svg2_settings, bee_const_data, x_2, "", offset=-130);

// sandbox beeswarm data -------------------------

bee_sandbox_data = learn.array_to_object(data);

learn.add_beeswarm(svg3, "svg3", svg3_settings, bee_sandbox_data, x_3, "", offset=-130);

// END ----------------------------------------------------------

// answering questions section  -------------------------------------------

svg4_settings = {
	margin: {top: 10, right: 30, bottom: 30, left: 40},
	width: 500 - margin.left - margin.right,
	height: 500 - margin.top - margin.bottom,
	center: 200,
	line_height: 50,
	x_domain: [450, 0],
	graph_title: "Distribution of snowfall",
	graph_axis: "Snowfall (in cms)",
  	orientation: "vertical",
  	labels: false
}

var values_4 = learn.init_svg(".container-4 #graph", svg4_settings);
var svg4 = values_4[0];
var x_4 = values_4[1];

var mountain_1 = [ 52, 85, 120, 125, 154, 140, 186, 206, 395, 420]; // NEEDS TO BE ORDERED
var mountain_2 = [ 135, 145, 154, 162, 185, 252, 275, 278, 344, 382 ]; // NEEDS TO BE ORDERED

var mountain_1_stats = learn.calculate_stats(mountain_1);
var mountain_2_stats = learn.calculate_stats(mountain_2);
 
  var gs4 = d3.graphScroll()
      .offset(300) // sets the offset overall
      .container(d3.select('.container-4'))
      .graph(d3.selectAll('.container-4 #graph'))
      .eventId('uniqueId4')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-4 #sections > div'))
      .on('active', function(i){

        if (i == 0) {

          svg4.append("rect")
            .attr('x', -40)
            .attr('y', -50)
            .attr("width", "100%")
            .attr("height", "140%")
            .attr("fill", "white")

          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_2.png")
        }
        else if (i == 1) {

		  learn.set_timeline_section("part-answer");

          svg4.append("rect")
            .attr('x', -40)
            .attr('y', -50)
            .attr("width", "100%")
            .attr("height", "140%")
            .attr("fill", "white")

          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_5.png")
        }

        else if (i == 2) {

          svg4.append("rect")
            .attr('x', -40)
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "#ececed");

            learn.show_scale(svg4, svg4_settings, x_4)

            // TODO update the highlighting id references to match this
            learn.add_boxplot(svg4, "mountain_1", svg4_settings, mountain_1_stats, x_4, "The Snowy Peak", offset=100);

        }

        else if (i == 3) {

       	// TODO if you scroll too quickly the boxplots do not appear
        // TODO update the highlighting id references to match this
        learn.add_boxplot(svg4, "mountain_2", svg4_settings, mountain_2_stats, x_4, "The Cursed Hill");
        
        }

        else if (i == 4) {
            svg4.select("g.scale")
              .style("fill", "blue")
        }

        else if (i == 5) {
            svg4.select("g.scale")
              .style("fill", "none")


            learn.highlight(svg4, "#mountain_1-vert-line", true);
            learn.highlight(svg4, "#mountain_2-vert-line", true);
              
        }

        else if (i == 6) {
            learn.highlight(svg4, "#mountain_2-vert-line", false);
        }

        else if (i == 7) {
            learn.highlight(svg4, "#mountain_1-vert-line", false);
            learn.highlight(svg4, "#mountain_2-vert-line", true);
        }

        else if (i == 8) {
            learn.highlight(svg4, "#mountain_2-vert-line", false);

          svg4
          .append("line")
            .transition()
            .duration(1000)
            .attr("class", "snowfall")
            .attr("x1", svg4_settings.center - 150)
            .attr("x2", svg4_settings.center + 60)
            .attr("y1", x_4(200))
            .attr("y2", x_4(200))
            .style("stroke", "blue")
            .style("stroke-width", 10)
        }

        else if (i == 9) {

          svg4
          .append("rect")
            .transition()
            .duration(1000)
            .attr("x", svg4_settings.center - svg4_settings.line_height/2)
            .attr("y", x_4(382))
            .attr("height", 140)
            .attr("width", 50)
            .style("opacity", 0.2)
            .attr("stroke", "blue")
            .style("fill", "blue")

        }
        else if (i == 10) {
          svg4.append("rect")
            .attr('x', -40)
            .attr('y', -50)
            .attr("width", "100%")
            .attr("height", "140%")
            .attr("fill", "white")

          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_3.png")
        }
        
      })


// END -------------------------------------------------------------

// sandbox scroll setup --------------------------------------



  var path = svg3.append('path')

  var gs3 = d3.graphScroll()
      .container(d3.select('.container-3'))
      .graph(d3.selectAll('.container-3 #graph'))
      .eventId('uniqueId3')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-3 #sections > div'))
      .on('active', function(i){
        // code to affect while scrolling

        if (i == 1) {
			learn.set_timeline_section("part-sand");
        }

      })
// END ----------------------------------------------------------

// Hover effects -------------------------------

// BUG sometimes shows it as stroke 5 black-- might be due the deletion/recreation and duplicates?

learn.hover_text("const-median-hl", svg2, "line.median-line");
learn.hover_text("const-q1-hl", svg2, "line.q1-line");
learn.hover_text("const-q3-hl", svg2, "line.q3-line");
learn.hover_text("const-min-hl", svg2, "line.min-line");
learn.hover_text("const-max-hl", svg2, "line.max-line");

// END ------------------------------------------------------


// hover effects sandbox ------------------------------------

learn.hover_text("min-hl", svg3, "line.min-line");
learn.hover_text("max-hl", svg3, "line.max-line");
learn.hover_text("median-hl", svg3, "line.median-line");
learn.hover_text("iqr-hl", svg3, "rect");
learn.hover_text("q1-hl", svg3, "line.q1-line");
learn.hover_text("q3-hl", svg3, "line.q3-line");

// END ----------------------------------------------------------

  d3.select('#source')
      .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
}
render()
d3.select(window).on('resize', render)





</script>
