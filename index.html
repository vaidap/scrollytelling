
<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<link href="https://fonts.googleapis.com/css?family=Bree+Serif|Open+Sans:300,300i,700&display=swap" rel="stylesheet"> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>

body{
  max-width: 1200px;
  margin: 0px auto;
/*  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;*/
  font-family: "Open Sans", Arial, sans-serif;
  font-weight: 300;
}

/* header styling */

h1{
  margin: 50px;
}

h1, h2, h3 {
  color: #2980b9;
}

div.header h1, div.header h2 {
  text-align: center;
  font-family: "Bree Serif", Times New Roman, serif;  
  text-transform: uppercase;
}

div.header h1 {
  margin-top: 0px;
  font-size: 150px;
}

div.header h2.above {
  margin-top: 200px;
  margin-bottom: -40px;
  font-size: 30px;
}

div.header h2.beyond {
  margin-top: -70px;
  margin-bottom: 150px;
  font-size: 30px;
}

.box-plot-header {
  border: 2px solid black;
  height: 50px;
}

/* sections & graph styling */

/*div.container-0 div#sections {
  font-size: 30px;
}

div.container-0 div#sections > div {
  margin-bottom: 50px;
}
*/

div.container-3 div#sections {
  font-size: 18px;
}

div.container-3 div#sections h3 {
  font-size: 28px;
}

div#sections div {
  min-height: 80px;
}

/*div#sections div.one-liner {
  line-height:200px;
}*/

div#sections div.last-div {
  min-height: 300px;
}

/*div#sections div div.buffer {
  max-height:200px;
}*/

div.separator {
  height: 100px;
}

#container{
  position: relative;
}

#sections{
  width: 600px;
  font-size: 28px;
  text-align: justify;
}

#sections > div{
  background: white;
  opacity: .2;
  margin-bottom: 50px;
}
/*#sections > div:last-child{
  margin-bottom: 30px;
}*/
#sections > div.graph-scroll-active{
  opacity: 1;
}

#graph{
  margin-left: 40px;
  width: 500px;
  position: -webkit-sticky;
  position: sticky;
  top: 100px;
  float: right;
}

@media (max-width: 925px)  {
  #graph{
    width: 100%;
    margin-left: 0px;
    float: none;
  }

  #sections{
    width: auto;
    position: relative;
    margin: 0px auto;
  }

  #sections > div{
    background: rgba(255,255,255,.5);
    padding: 10px;
    border-top: 1px solid;
    border-bottom: 1px solid;
    margin-bottom: 80vh;
  }

  pre{
    overflow: hidden;
  }

  h1{
    margin: 10px;
  }
}


circle{
  fill: steelblue;
}

.mono{
  font-family: monospace;
}

svg{
  background-color: #eee;
}

.hl-word {
	border: 1px solid blue;
	border-radius: 5px;
	padding: 1px 3px 1px 3px;
}

.hl-word:hover {
	background-color:blue;
	color: white;
	-webkit-transition: all 500ms ease;
	-moz-transition: all 500ms ease;
	-o-transition: all 500ms ease;
	transition: all 500ms ease;
}

.intro-text {
  min-height: 300px;
  text-align: justify;
}

.type-orange {
  color: #fbc531;
  border-bottom: 3px dashed #fbc531;
}

.type-green {
  color: #44bd32;
  border-bottom: 3px dashed #44bd32;
}

.type-purple {
  color: #9c88ff;
  border-bottom: 3px dashed #9c88ff;
}

.bolded {
  font-weight: bold;
}

.intro-text a {
  text-decoration: none;
}

.intro-text a:hover {
  opacity: 0.5;
  -webkit-transition: all 500ms ease;
  -moz-transition: all 500ms ease;
  -o-transition: all 500ms ease;
  transition: all 500ms ease;
}

</style>
</head>

<div class="header">
<h2 class="above">An interactive introduction to</h2>
<h1>Box plots</h1>
<h2 class="beyond">and what they're good for</h2>
</div>

<div class="intro-text">
  <h1>Boxplots are a fairly popular visualisation type, but one needs to know how to read them in order to extract useful conclusions. This introductory explainer contains an <a href="#intro-link" class="type-orange">example scenario</a>, a <a href="#const-link" class="type-green">vis construction</a>, and a <a href="#sandbox-link" class ="type-purple"> sandbox</a> to get you started.</h1>
</div>

<div id='container' class='container-0'>
  <div id='graph'></div>
  <div id='sections'>
    <div class="one-liner">
      <div class="buffer"></div>
      <h3 id="intro-link">Introduction</h3>
      [restaurant noises]
    </div>

    <div>
      Do you have any plans for the coming Easter holiday?
    </div>

    <div>
      Let's go skiing!
    </div>

    <div>
      That's a good idea! But we don't know which mountain will have snow, and it's too early to see the weather forecast.
    </div>


    <div>
      It seems we need to find a place with a high chance of snow.
    </div>

    <div class="last-div">
      What about using <span class="bolded">boxplots</span> to visualise and compare different mountain snowfall?
    </div>

  </div>

</div>

<div id='container' class='container-2'>
  <div id='graph'></div>
<!--   <div id="my_dataviz"></div> -->

  <div id='sections'>

    <div>
      <h3 id="const-link">Construction</h3>
        Let's start with snowfall data from one mountain, and construct a boxplot. As a first step, we can <span class="bolded">order the values by ascending order</span>.
    </div>

    <div>
      By <span class="bolded">splitting the data into two equal groups</span>, we obtain the middle value, called the <span class="hl-word const-median-hl">median</span>.
    </div>


    <div>
      The median values obtained by <span class="bolded">splitting the lower and higher halves</span> are called the <span class="hl-word const-q1-hl">lower quartile</span> and <span class="hl-word const-q3-hl">higher quartile</span>.
    </div>

    <div>
      We link these three values with a <span class="bolded">box.
    </div>

    <div class="last-div">
      Finally, we plot the <span class="hl-word const-min-hl">minimum</span> and <span class="hl-word const-max-hl">maximum</span>, which make the "whiskers" of our graph.
    </div>
  </div>


</div>

<div class="separator"></div>

<div class="intro-text">
<h1 id="sandbox-link">
  It's time to try it out yourself! Edit the data table, or hover over the statistics to see how the boxplot is affected by changes in data.
</h1>
</div>

<!-- sandbox -->
<div id='container' class='container-3'>
  <div id='graph'></div>

  <div id='sections'>

    <div style="min-height: 800px;">
      <h3>Sandbox</h3>
       <table id= "test-table" style="border: 1px solid blue; border-radius: 5px; padding:10px;">
        <tr>
          <th>Year</th>
          <th>Snowfall</th>
        </tr>
        <tr>
          <td>2020</td>
          <td>      
            <label for="data-1" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-1-value"></span>
            </label>
            <input type="number" min="0" max="360" value="12" id="data-1" class="dataval"></td>
        </tr>
        <tr>
          <td>2019</td>
          <td>
            <label for="data-2" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-2-value"></span>
            </label>
            <input type="number" min="0" max="360" value="19" id="data-2" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2018</td>
          <td>
            <label for="data-3" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-3-value"></span>
            </label>
            <input type="number" min="0" max="360" value="12" id="data-3" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2017</td>
          <td>
            <label for="data-4" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-4-value"></span>
            </label>
            <input type="number" min="0" max="360" value="11" id="data-4" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2016</td>
          <td>
            <label for="data-5" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-5-value"></span>
            </label>
            <input type="number" min="0" max="360" value="22" id="data-5" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2015</td>
          <td>
            <label for="data-6" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-6-value"></span>
            </label>
            <input type="number" min="0" max="360" value="13" id="data-6" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2014</td>
          <td>
            <label for="data-7" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-7-value"></span>
            </label>
            <input type="number" min="0" max="360" value="4" id="data-7" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2013</td>
          <td>
            <label for="data-8" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-8-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="5" id="data-8" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2012</td>
          <td>
            <label for="data-9" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-9-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="15" id="data-9" class="dataval"></td>
          </td>
        </tr>
        <tr>
          <td>2011</td>
          <td>
            <label for="data-10" 
               style="display: inline-block; width: 240px; text-align: right">
               <span id="data-10-alue"></span>
            </label>
            <input type="number" min="0" max="360" value="16" id="data-10" class="dataval"></td>
          </td>
        </tr>
      </table> 

      <p>
        <span class="hl-word min-hl">Min: <span id="min-stat"></span></span>
        <span class="hl-word max-hl">Max: <span id="max-stat"></span></span>
        <span class="hl-word median-hl">Median: <span id="median-stat"></span></span>
      </p>
      <p>
        <span class="hl-word q1-hl">Q1: <span id="q1-stat"></span></span>
        <span class="hl-word iqr-hl">Interquartile Range: <span id="inter-stat"></span></span>
        <span class="hl-word q3-hl">Q3: <span id="q3-stat"></span></span>
      </p>

    </div>
  </div>
</div>

<div id='container' class='container-4'>
  <div id='graph'></div>
<!--   <div id="my_dataviz"></div> -->

  <div id='sections'>

    <div>
      Great! But how do we use boxplots to make a decision?
    </div>

    <div>
      First, we need to plot data from another mountain. Then we can compare.
   </div>
    <div>
      Here's our mountain 1 data...
   </div>
    <div>
      And here's some data from mountain 2. 
   </div>
   <div>
      Note that the <span class="bolded">scale</span> should be the same for them to be comparable!
   </div>
   <div>
      The extreme values give us information on the minimum, maximum and <span class="bolded">variance</span>: the spread of data.
   </div>
   <div>
      Mountain 1 has greater variance: this means the annual snowfall data is more spread out.
   </div>
   <div>
    Meanwhile, Mountain 2 has smaller variance, which means that snowfall doesn't vary as much year to year.
   </div>
  </div>


</div>

<div id='container' class='container-5'>
  <div id='graph'></div>
<!--   <div id="my_dataviz"></div> -->

  <div id='sections'>

  <div>
    Test 1
  </div>
    <div>
    Test 1
  </div>
    <div>
    Test 1
  </div>
    <div>
    Test 1
  </div>
    <div>
    Test 1
  </div>
  </div>


</div>

<!-- OLD MOCKUP CONSTRUCTION -->

<!-- <div id='container' class='container-1'>
  <div id='graph'></div>
  <div id='sections'>
    <div>
      <h3>Construction</h3>
        Let's start with one set of data. As a first step, we can order the values by ascending order.
    </div>

    <div>
      By splitting the data into two equal groups, we obtain the middle value, called the <span class="hl-word">median</span>.
    </div>


    <div>
      The median values obtained by splitting the lower and higher halves are called the <span class="hl-word">lower quartile</span> and <span class="hl-word">higher quartile</span>.
    </div>

    <div>
      We link these three values with a box.
    </div>

    <div class="last-div">
      Finally, we plot the <span class="hl-word">minimum</span> and <span class="hl-word">maximum</span>, which make the "whiskers" of our graph.
    </div>

  </div>

</div> -->

<!-- <h1 id='source'><a href='https://github.com/1wheel/graph-scroll'>contribute/view source on github</a></h1> -->


<script src="d3v4+jetpack.js"></script>
<script src="graph-scroll.js"></script>
<script>

// BOXPLOT SETUP ----------------------------------------------------

// set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 40},
  width = 400 - margin.left - margin.right,
  height = 400 - margin.top - margin.bottom;
// END --------------------------------------------------------------


// graph-scroll setup -----------------------------------------------

var oldWidth = 0
function render(){
  if (oldWidth == innerWidth) return
  oldWidth = innerWidth

  var width = height = d3.select('#graph').node().offsetWidth
  var r = 40


  if (innerWidth <= 925){
    width = innerWidth
    height = innerHeight*.7
  }

  // return console.log(width, height)
// END -------------------------------------------------------------

// Testing static images -------------------------------------------

  var svg0 = d3.select('.container-0 #graph').html('')
    .append('svg')
    .attrs({width: width, height: height});

    svg0.append("rect")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("fill", "white");

    // svg0.append("svg:image")
    // .attr('x', -9)
    // .attr('y', -12)
    // .attr('width', width)
    // .attr('height', height)
    // .attr("xlink:href", "images/comic_1.png")
 
  var comic_squares = ["comic_1", "comic_2", "comic_3", "comic_4", "comic_5", "comic_2"]
  var gs0 = d3.graphScroll()
  	  .offset(300) // sets the offset overall
      .container(d3.select('.container-0'))
      .graph(d3.selectAll('.container-0 #graph'))
      .eventId('uniqueId0')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-0 #sections > div'))
      .on('active', function(i){
        // transitions
        svg0.append("svg:image")
        .attr('x', -9)
        .attr('y', -12)
        .attr('width', 500)
        .attr('height', 500)
        .attr("xlink:href", "images/" + comic_squares[i] + ".png")
      })


// END -------------------------------------------------------------


// example circle --------------------------------------------------

  // var svg = d3.select('.container-1 #graph').html('')
  //   .append('svg')
  //     .attrs({width: width, height: height})

  // var circle = svg.append('circle')
  //     .attrs({cx: 0, cy: 0, r: r})

  // var colors = ['orange', 'purple', 'steelblue', 'pink', 'black']
  // var gs = d3.graphScroll()
  //     .container(d3.select('.container-1'))
  //     .graph(d3.selectAll('container-1 #graph'))
  //     .eventId('uniqueId1')  // namespace for scroll and resize events
  //     .sections(d3.selectAll('.container-1 #sections > div'))
  //     // .offset(innerWidth < 900 ? innerHeight - 30 : 200)
  //     .on('active', function(i){
  //       var pos = [ {cx: width - r, cy: r},
  //                   {cx: r,         cy: r},
  //                   {cx: width - r, cy: height - r},
  //                   {cx: width/2,   cy: height/2} ][i]
        
  //       circle.transition().duration(1000)
  //           .attrs(pos)
  //         .transition()
  //           .style('fill', colors[i])
  //     })
// END -----------------------------------------------------------


// CONSTRUCTION MOCKUP -------------------------------------------

  // var svg1 = d3.select('.container-1 #graph').html('')
  //   .append('svg')
  //   .attrs({width: width, height: height});

  //   svg1.append("rect")
  //   .attr("width", "100%")
  //   .attr("height", "100%")
  //   .attr("fill", "white");

  //   // svg0.append("svg:image")
  //   // .attr('x', -9)
  //   // .attr('y', -12)
  //   // .attr('width', width)
  //   // .attr('height', height)
  //   // .attr("xlink:href", "images/comic_1.png")
 
  // var const_squares = ["const1", "const2", "const3", "const3", "const4"]
  // var box_squares = ["box_0", "box_1", "box_2", "box_3", "box_4"]
  // var gs1 = d3.graphScroll()
  //     .container(d3.select('.container-1'))
  //     .graph(d3.selectAll('.container-1 #graph'))
  //     .eventId('uniqueId1')  // namespace for scroll and resize events
  //     .sections(d3.selectAll('.container-1 #sections > div'))
  //     .on('active', function(i){
  //       // transitions
  //       svg1.append("svg:image")
  //       .attr('x', -9)
  //       .attr('y', -130)
  //       .attr('width', 500)
  //       .attr('height', 500)
  //       .attr("xlink:href", "images/" + const_squares[i] + ".png")
  //       svg1.append("svg:image")
  //       .attr('x', -9)
  //       .attr('y', 120)
  //       .attr('width', 500)
  //       .attr('height', 500)
  //       .attr("xlink:href", "images/" + box_squares[i] + ".png")
  //     })

// END -----------------------------------------------------------


// BOXPLOT CONSTRUCTION FROM MOCKUP ---------------------------------------

// set the dimensions and margins of the graph
var margin_2 = {top: 10, right: 30, bottom: 30, left: 40},
  width_2 = 500 - margin_2.left - margin_2.right,
  height_2 = 300 - margin_2.top - margin_2.bottom;

// Show the X scale
var x_2 = d3.scaleLinear()
  .domain([0,400])
  .range([0, width_2])

// append the svg object to the body of the page
var svg2 = d3.select(".container-2 #graph").html('')
.append("svg")
  .attr("width", width_2 + margin_2.left + margin_2.right)
  .attr("height", height_2 + margin_2.top + margin_2.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin_2.left + "," + margin_2.top + ")");


// END -------------------------------------------------------------------


// BASIC VERTICAL BOXPLOT -------------------------------------------------

//   var svg2 = d3.select('.container-2 #graph').html('')
//     .append('svg')
//       // .attrs({width: width, height: height})
// .attr("width", width + margin.left + margin.right)
//   .attr("height", height + margin.top + margin.bottom)
// .append("g")
//   .attr("transform",
//         "translate(" + margin.left + "," + margin.top + ")");

// // create dummy data
// var data = [12,19,11,13,12,22,13,4,15,16,18,19,20,12,11,9]

// // Compute summary statistics used for the box:
// var data_sorted = data.sort(d3.ascending)
// var q1 = d3.quantile(data_sorted, .25)
// var median = d3.quantile(data_sorted, .5)
// var q3 = d3.quantile(data_sorted, .75)
// var interQuantileRange = q3 - q1
// var min = q1 - 1.5 * interQuantileRange
// var max = q1 + 1.5 * interQuantileRange

// // Show the Y scale
// var y = d3.scaleLinear()
//   .domain([0,24])
//   .range([height, 0]);
// svg2.call(d3.axisLeft(y))

// // a few features for the box
// var center = 200
// var width = 100

// // Show the main vertical line
// svg2
// .append("line")
//   .attr("x1", center)
//   .attr("x2", center)
//   .attr("y1", y(min) )
//   .attr("y2", y(max) )
//   .attr("stroke", "black")

// // Show the box
// svg2
// .append("rect")
//   .attr("x", center - width/2)
//   .attr("y", y(q3) )
//   .attr("height", (y(q1)-y(q3)) )
//   .attr("width", width )
//   .attr("stroke", "black")
//   .style("fill", "#69b3a2")

// // show median, min and max horizontal lines
// svg2
// .selectAll("toto")
// .data([min, median, max])
// .enter()
// .append("line")
//   .attr("x1", center-width/2)
//   .attr("x2", center+width/2)
//   .attr("y1", function(d){ return(y(d))} )
//   .attr("y2", function(d){ return(y(d))} )
//   .attr("stroke", "black")

// END ----------------------------------------------------------



// sandbox boxplot ----------------------------------------------

// set the dimensions and margins of the graph
var margin_2 = {top: 10, right: 30, bottom: 30, left: 40},
  width = 500 - margin.left - margin.right,
  height = 300 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg3 = d3.select(".container-3 #graph").html('')
.append("svg")
  .attr("width", width + margin_2.left + margin_2.right)
  .attr("height", height + margin_2.top + margin_2.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin_2.left + "," + margin_2.top + ")");

// create dummy data
var data =  [ 4, 5, 11, 12, 12, 13, 15, 16, 19, 22 ]
var data_sorted = data;

// Compute summary statistics used for the box:
var data_sorted = data.sort(d3.ascending)
var q1 = d3.quantile(data_sorted, .25)
var median = d3.quantile(data_sorted, .5)
var q3 = d3.quantile(data_sorted, .75)
var interQuantileRange = q3 - q1
var min = q1 - 1.5 * interQuantileRange
var max = q1 + 1.5 * interQuantileRange

// Show the Y scale
// var y = d3.scaleLinear()
//   .domain([0,24])
//   .range([height, 0]);
// svg.call(d3.axisLeft(y))

// Show the X scale
var x = d3.scaleLinear()
  .domain([0,24])
  .range([0, width])
svg3.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x))

// a few features for the box
var center = 200
var height = 50

// Show the main vertical line
svg3
.append("line")
  .attr("class", "vert-line")
  .attr("x1", x(min))
  .attr("x2", x(max))
  .attr("y1", center )
  .attr("y2", center )
  .attr("stroke", "black")

console.log(center - width/2)
console.log(x(q3))
console.log((x(q1)-x(q3)))
console.log(width)
// Show the box
svg3
.append("rect")
  .attr("x", x(q1) )
  .attr("y",  center - height/2)
  .attr("height", height)
  .attr("width", (x(q3)-x(q1)))
  .attr("stroke", "black")
  .style("fill", "#69b3a2")

// show median, min and max horizontal lines
// svg
// .selectAll("toto")
// .data([min, median, max])
// .enter()
// .append("line")
//   .attr("x1", function(d){ return(x(d))})
//   .attr("x2", function(d){ return(x(d))})
//   .attr("y1", center-height/2 )
//   .attr("y2", center+height/2)
//   .attr("stroke", "black")

svg3.append("line")
  .attr("class", "min-line")
  .attr("x1", x(min))
  .attr("x2", x(min))
  .attr("y1", center-height/2)
  .attr("y2", center+height/2)
  .attr("stroke", "black")

svg3.append("line")
  .attr("class", "median-line")
  .attr("x1", x(median))
  .attr("x2", x(median))
  .attr("y1", center-height/2)
  .attr("y2", center+height/2)
  .attr("stroke", "black")

svg3.append("line")
  .attr("class", "max-line")
  .attr("x1", x(max))
  .attr("x2", x(max))
  .attr("y1", center-height/2)
  .attr("y2", center+height/2)
  .attr("stroke", "black")


svg3.append("line")
  .attr("class", "q1-line")
  .attr("x1", x(q1))
  .attr("x2", x(q3))
  .attr("y1", center-height/2)
  .attr("y2", center+height/2)

svg3.append("line")
  .attr("class", "q3-line")
  .attr("x1", x(q1))
  .attr("x2", x(q3))
  .attr("y1", center-height/2)
  .attr("y2", center+height/2)
  .attr("stroke", "black")
  .attr("stroke", "black")


// TABLE UPDATE

var elements = document.getElementsByClassName("dataval");

var update_datavis = function() {

  data = [];

  $("table#test-table tr td input.dataval").each(function() {  
    data.push(Number($(this).val()));
});
  console.log(data);

  // recalculate stats
  data_sorted = data.sort(d3.ascending);
  console.log(data_sorted)
  q1 = d3.quantile(data_sorted, .25);
  median = d3.quantile(data_sorted, .5);
  q3 = d3.quantile(data_sorted, .75);
  interQuantileRange = q3 - q1;
  // min = q1 - 1.5 * interQuantileRange;
  // max = q1 + 1.5 * interQuantileRange;
  min = Math.min(...data);
  max = Math.max(...data);

  //reupdate range & ticks
  x.domain([min, max]);
  svg3.select("g")
    .transition()
    .duration(1000)
    .call(d3.axisBottom(x))

  // update displayed statistics
  d3.select("#q1-stat").text(q1);
  d3.select("#q3-stat").text(q3);
  d3.select("#median-stat").text(median);
  d3.select("#inter-stat").text(interQuantileRange);
  d3.select("#min-stat").text(min);
  d3.select("#max-stat").text(max);

  // update visualisation
  svg3.select("rect")
    .transition()
    .duration(1000)
    .attr("x", x(q1))
    .attr("y",  center - height/2)
    .attr("height", height)
    .attr("width", (x(q3)-x(q1)))
    .attr("stroke", "black")
    .style("fill", "#69b3a2")

  svg3.select("line.vert-line")
    .transition()
    .duration(1000)
    .attr("x1", x(min))
    .attr("x2", x(max))

  svg3.select("line.min-line")
    .transition()
    .duration(1000)
    .attr("x1", x(min))
    .attr("x2", x(min))

  svg3.select("line.median-line")
    .transition()
    .duration(1000)
    .attr("x1", x(median))
    .attr("x2", x(median))

  svg3.select("line.max-line")
    .transition()
    .duration(1000)
    .attr("x1", x(max))
    .attr("x2", x(max))

  svg3.select("line.q1-line")
    .transition()
    .duration(1000)
    .attr("x1", x(q1))
    .attr("x2", x(q1))

  svg3.select("line.q3-line")
    .transition()
    .duration(1000)
    .attr("x1", x(q3))
    .attr("x2", x(q3))

};

for (var i = 0; i < elements.length; i++) {
    elements[i].addEventListener('input', update_datavis , false);
}

// BOX UPDATE

// when the input range changes update the circle 
d3.select("#nRadius").on("input", function() {
  console.log("basic change");
  update_box(+this.value);
});

// Initial starting radius of the circle 
update_box(x(q3));

// update the elements
function update_box(nRadius) {

  // adjust the text on the range slider
  d3.select("#nRadius-value").text(nRadius);
  d3.select("#nRadius").property("value", nRadius);

  // update the circle radius
  svg3.selectAll("rect") 
    .attr("x", nRadius);
}


// LINE UPDATE

// when the input range changes update the circle 
d3.select("#nLine").on("input", function() {
  update_line(+this.value);
});

// Initial starting radius of the circle 
update_line(0);

// update the elements
function update_line(nLine) {

  // adjust the text on the range slider
  d3.select("#nLine-value").text(nLine);
  d3.select("#nLine").property("value", nLine);

  // update the circle radius
  svg3.select("line.vert-line")
    .attr("x1", x(min) - nLine)
    .attr("x2", x(max) - nLine)
}

// initialise the datavis to data table
update_datavis();


// hover effects construction -------------------------------

// sometimes shows it as stroke 5 black-- might be due the deletion/recreation and duplicates?

let const_median_hl = document.getElementsByClassName("const-median-hl");
  
const_median_hl[0].addEventListener("mouseenter", function( event ) {   

  svg2.select("line.median-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

const_median_hl[0].addEventListener("mouseleave", function( event ) {   

  svg2.select("line.median-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let const_q1_hl = document.getElementsByClassName("const-q1-hl");
  
const_q1_hl[0].addEventListener("mouseenter", function( event ) {   

  svg2.select("line.q1-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

const_q1_hl[0].addEventListener("mouseleave", function( event ) {   

  svg2.select("line.q1-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let const_q3_hl = document.getElementsByClassName("const-q3-hl");
  
const_q3_hl[0].addEventListener("mouseenter", function( event ) {   

  svg2.select("line.q3-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

const_q3_hl[0].addEventListener("mouseleave", function( event ) {   

  svg2.select("line.q3-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let const_min_hl = document.getElementsByClassName("const-min-hl");

const_min_hl[0].addEventListener("mouseenter", function( event ) {   

  svg2.select("line.min-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

const_min_hl[0].addEventListener("mouseleave", function( event ) {   

  svg2.select("line.min-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let const_max_hl = document.getElementsByClassName("const-max-hl");

const_max_hl[0].addEventListener("mouseenter", function( event ) {   

  svg2.select("line.max-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

const_max_hl[0].addEventListener("mouseleave", function( event ) {   

  svg2.select("line.max-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);


// END ------------------------------------------------------


// hover effects sandbox ------------------------------------

let min_hl = document.getElementsByClassName("min-hl");
  
min_hl[0].addEventListener("mouseenter", function( event ) {   

  svg3.select("line.min-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

min_hl[0].addEventListener("mouseleave", function( event ) {   

  svg3.select("line.min-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let max_hl = document.getElementsByClassName("max-hl");
  
max_hl[0].addEventListener("mouseenter", function( event ) {   

  svg3.select("line.max-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

max_hl[0].addEventListener("mouseleave", function( event ) {   

  svg3.select("line.max-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let median_hl = document.getElementsByClassName("median-hl");
  
median_hl[0].addEventListener("mouseenter", function( event ) {   

  svg3.select("line.median-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

median_hl[0].addEventListener("mouseleave", function( event ) {   

  svg3.select("line.median-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);


let iqr_hl = document.getElementsByClassName("iqr-hl");
  
iqr_hl[0].addEventListener("mouseenter", function( event ) {   

  svg3.select("rect")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

iqr_hl[0].addEventListener("mouseleave", function( event ) {   

  svg3.select("rect")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let q1_hl = document.getElementsByClassName("q1-hl");
  
q1_hl[0].addEventListener("mouseenter", function( event ) {   

  svg3.select("line.q1-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

  svg3.select("line.median-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

q1_hl[0].addEventListener("mouseleave", function( event ) {   

  svg3.select("line.q1-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

  svg3.select("line.median-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);

let q3_hl = document.getElementsByClassName("q3-hl");
  
q3_hl[0].addEventListener("mouseenter", function( event ) {   

  svg3.select("line.q3-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

  svg3.select("line.median-line")
    .attr("stroke", "blue")
    .style("stroke-width", 5)

}, false);

q3_hl[0].addEventListener("mouseleave", function( event ) {   

  svg3.select("line.q3-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

  svg3.select("line.median-line")
    .attr("stroke", "black")
    .style("stroke-width", 1)

}, false);



// END ----------------------------------------------------------



// construction scroll setup --------------------------------------

svg2.selectAll("line.median-line").remove()


  var path = svg2.append('path')

  var gs2 = d3.graphScroll()
      .container(d3.select('.container-2'))
      .graph(d3.selectAll('.container-2 #graph'))
      .eventId('uniqueId2')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-2 #sections > div'))
      .on('active', function(i){ // JUMP
        console.log("Active:" + i);

        var const_squares_2 = ["const_1", "const_2", "const_3", "const_3", "const_4"]

        svg2.append("svg:image")
          .attr('x', -40)
          .attr('y', 0)
          .attr('width', 500)
          .attr('height', 96)
          .attr("xlink:href", "images/" + const_squares_2[i] + ".jpg")

        // show the x scale
        svg2.append("g")
          .attr("transform", "translate(0," + height_2 + ")")
          .call(d3.axisBottom(x_2))

        if (i == 0) {
          svg2.selectAll("line.median-line").remove()
        }
    
        else if (i == 1) {

          svg2.selectAll("line.q1-line").remove()
          svg2.selectAll("line.q3-line").remove()
          svg2.selectAll("rect").remove()

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "median-line")
            .attr("x1", x_2(195))
            .attr("x2", x_2(195))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")


        }

        else if (i == 2) {

          svg2.selectAll("rect").remove()

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "q1-line")
            .attr("x1", x_2(125))
            .attr("x2", x_2(125))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "q3-line")
            .attr("x1", x_2(260))
            .attr("x2", x_2(260))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

        }

        else if (i == 3) {

          svg2.selectAll("line.min-line").remove()
          svg2.selectAll("line.max-line").remove()
          svg2.selectAll("line.vert-line").remove()

          svg2.append("rect")
            .transition()
            .duration(1000)
            .attr("x", x_2(125) )
            .attr("y",  center - height/2)
            .attr("height", height)
            .attr("width", (x_2(260)-x_2(125)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

          // re-drawing as rectangle draws on top
          // svg2.selectAll("line").remove()

          svg2.append("line")
            .attr("class", "median-line")
            .attr("x1", x_2(195))
            .attr("x2", x_2(195))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q1-line")
            .attr("x1", x_2(125))
            .attr("x2", x_2(125))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q3-line")
            .attr("x1", x_2(260))
            .attr("x2", x_2(260))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")
        }

        else if (i == 4) {

          //couldn't be bothered to delete all lines except vertical
          // will do this if duplicates end up being an issue
          svg2.select("rect").remove()

          // Show the main vertical line
          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "vert-line")
            .attr("x1", x_2(45))
            .attr("x2", x_2(380))
            .attr("y1", center )
            .attr("y2", center )
            .attr("stroke", "black")


          svg2.append("rect")
            .attr("x", x_2(125) )
            .attr("y",  center - height/2)
            .attr("height", height)
            .attr("width", (x_2(260)-x_2(125)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

          svg2.append("line")
            .attr("class", "median-line")
            .attr("x1", x_2(195))
            .attr("x2", x_2(195))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "min-line")
            .attr("x1", x_2(45))
            .attr("x2", x_2(45))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .transition()
            .duration(1000)
            .attr("class", "max-line")
            .attr("x1", x_2(380))
            .attr("x2", x_2(380))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q1-line")
            .attr("x1", x_2(125))
            .attr("x2", x_2(125))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

          svg2.append("line")
            .attr("class", "q3-line")
            .attr("x1", x_2(260))
            .attr("x2", x_2(260))
            .attr("y1", center-height/2)
            .attr("y2", center+height/2)
            .attr("stroke", "black")

        }


      })
// END ----------------------------------------------------------

// answering questions section  -------------------------------------------

// set the dimensions and margins of the graph
var margin_4 = {top: 10, right: 30, bottom: 30, left: 40},
  width_2 = 500 - margin_4.left - margin_4.right,
  height_2 = 300 - margin_4.top - margin_4.bottom;

// append the svg object to the body of the page
var svg4 = d3.select(".container-4 #graph").html('')
.append("svg")
  .attr("width", width_2 + margin_4.left + margin_4.right)
  .attr("height", height_2 + margin_4.top + margin_4.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin_4.left + "," + margin_4.top + ")");

  // a few features for the box
var center_draw = 200
var height_draw = 50


var mountain_1 = [ 52, 85, 120, 125, 154, 140, 186, 206, 395, 420]; // NEEDS TO BE ORDERED
var mountain_2 = [ 135, 145, 154, 162, 185, 252, 275, 278, 344, 382 ]; // NEEDS TO BE ORDERED

// Compute summary statistics used for the box:
var q1_1 = d3.quantile(mountain_1, .25)
var median_1 = d3.quantile(mountain_1, .5)
var q3_1 = d3.quantile(mountain_1, .75)
var interQuantileRange_1 = q3_1 - q1_1
var min_1 = Math.min(...mountain_1);
var max_1 = Math.max(...mountain_1);

var q1_2 = d3.quantile(mountain_2, .25)
var median_2 = d3.quantile(mountain_2, .5)
var q3_2 = d3.quantile(mountain_2, .75)
var interQuantileRange_2 = q3_2 - q1_2
var min_2 = Math.min(...mountain_2);
var max_2 = Math.max(...mountain_2);

// Show the X scale
var x_4 = d3.scaleLinear()
  .domain([0,450])
  .range([0, width_2])

// // a few features for the box
// var center_2 = 200
 
  var gs4 = d3.graphScroll()
      .offset(300) // sets the offset overall
      .container(d3.select('.container-4'))
      .graph(d3.selectAll('.container-4 #graph'))
      .eventId('uniqueId4')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-4 #sections > div'))
      .on('active', function(i){
        console.log(i);

        if (i == 0) {

          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_2.png")
        }
        else if (i == 1) {
          svg4.append("svg:image")
          .attr('x', -40)
          .attr('y', -100)
          .attr('width', 500)
          .attr('height', 500)
          .attr("xlink:href", "images/comic_5.png")
        }

        else if (i == 2) {

          svg4.append("rect")
            .attr('x', -40)
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "#ececed");

          // Show the X scale

          svg4.append("g")
            .attr("class", "scale")
            .attr("transform", "translate(0," + height_2 + ")")
            .call(d3.axisBottom(x_4))


          // Show the main vertical line
          svg4
          .append("line")
            .attr("class", "vert-line")
            .attr("x1", x_4(min_1))
            .attr("x2", x_4(max_1))
            .attr("y1", center_draw - 100)
            .attr("y2", center_draw - 100)
            .attr("stroke", "black")

          // Show the box
          svg4
          .append("rect")
            .attr("x", x_4(q1_1) )
            .attr("y",  center - height_draw/2 - 100)
            .attr("height", height_draw)
            .attr("width", (x_4(q3_1)-x_4(q1_1)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

            svg4.append("line")
              .attr("class", "min-line")
              .attr("x1", x_4(min_1))
              .attr("x2", x_4(min_1))
              .attr("y1", center-height/2 - 100)
              .attr("y2", center+height/2 - 100)
              .attr("stroke", "black")

            svg4.append("line")
              .attr("class", "median-line")
              .attr("x1", x_4(median_1))
              .attr("x2", x_4(median_1))
              .attr("y1", center-height/2 - 100)
              .attr("y2", center+height/2 - 100)
              .attr("stroke", "black")

            svg4.append("line")
              .attr("class", "max-line")
              .attr("x1", x_4(max_1))
              .attr("x2", x_4(max_1))
              .attr("y1", center-height/2 - 100)
              .attr("y2", center+height/2 - 100)
              .attr("stroke", "black")

        }

        else if (i == 3) {

          // Show the main vertical line
          svg4
          .append("line")
            .attr("class", "vert-line")
            .attr("x1", x_4(min_2))
            .attr("x2", x_4(max_2))
            .attr("y1", center_draw )
            .attr("y2", center_draw )
            .attr("stroke", "black")

          // Show the box
          svg4
          .append("rect")
            .attr("x", x_4(q1_2) )
            .attr("y",  center - height_draw/2)
            .attr("height", height_draw)
            .attr("width", (x_4(q3_2)-x_4(q1_2)))
            .attr("stroke", "black")
            .style("fill", "#69b3a2")

            svg4.append("line")
              .attr("class", "min-line")
              .attr("x1", x_4(min_2))
              .attr("x2", x_4(min_2))
              .attr("y1", center-height/2)
              .attr("y2", center+height/2)
              .attr("stroke", "black")

            svg4.append("line")
              .attr("class", "median-line")
              .attr("x1", x_4(median_2))
              .attr("x2", x_4(median_2))
              .attr("y1", center-height/2)
              .attr("y2", center+height/2)
              .attr("stroke", "black")

            svg4.append("line")
              .attr("class", "max-line")
              .attr("x1", x_4(max_2))
              .attr("x2", x_4(max_2))
              .attr("y1", center-height/2)
              .attr("y2", center+height/2)
              .attr("stroke", "black")
        }

        else if (i == 4) {
            svg4.select("g.scale")
              .attr("fill", "blue")
        }

        else if (i == 5) {
            svg4.select("g.scale")
              .attr("fill", "none")

            svg4.selectAll("line.vert-line")
              .attr("stroke", "blue")
              .style("stroke-width", 5)

              
        }
        
      })


// END -------------------------------------------------------------

// sandbox scroll setup --------------------------------------



  var path = svg3.append('path')

  var gs3 = d3.graphScroll()
      .container(d3.select('.container-3'))
      .graph(d3.selectAll('.container-3 #graph'))
      .eventId('uniqueId3')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-3 #sections > div'))
      .on('active', function(i){
        // code to affect while scrolling
      })
// END ----------------------------------------------------------

  d3.select('#source')
      .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
}
render()
d3.select(window).on('resize', render)





</script>
